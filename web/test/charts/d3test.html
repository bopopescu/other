<html><head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
<script src="jquery-1.7.2.min.js"></script>

<!-- web scrape -->
<script src="webscrape/d3.v3.js" ></script>
<script src="webscrape/scripts/Sitemap.js" ></script>
<script src="webscrape/scripts/Selector.js" ></script>
<script src="webscrape/scripts/Selector/SelectorElement.js" ></script>
<script src="webscrape/scripts/Selector/SelectorGroup.js" ></script>
<script src="webscrape/scripts/Selector/SelectorLink.js" ></script>
<script src="webscrape/scripts/Selector/SelectorClick.js" ></script>
<script src="webscrape/scripts/Selector/SelectorPopupLink.js" ></script>
<script src="webscrape/scripts/Selector/SelectorText.js" ></script>
<script src="webscrape/scripts/Selector/SelectorImage.js" ></script>
<script src="webscrape/scripts/Selector/SelectorHTML.js" ></script>
<script src="webscrape/scripts/Selector/SelectorElementAttribute.js" ></script>
<script src="webscrape/scripts/Selector/SelectorTable.js" ></script>
<script src="webscrape/scripts/Selector/SelectorElementScroll.js" ></script>
<script src="webscrape/scripts/Selector/SelectorElementClick.js" ></script>
<script src="webscrape/scripts/SelectorList.js" ></script>
<script src="webscrape/scripts/Queue.js" ></script>
<script src="webscrape/scripts/Job.js" ></script>
<script src="webscrape/scripts/Scraper.js" ></script>
<script src="webscrape/scripts/ChromePopupBrowser.js" ></script>
<script src="webscrape/scripts/Config.js" ></script>
<script src="webscrape/scripts/Store.js" ></script>
<script src="webscrape/scripts/ContentScript.js" ></script>
<script src="webscrape/scripts/SelectorGraphv2.js" ></script>
<style>
html {
	height:100%;
}
body {
	margin:0;
	border:1px solid #eee;
	height:100%;
	position:relative;
	background:#F3F8FC;
}
.chart{
	width:100%;
	height:100%;
	left:0;
	width:50%;
	position:absolute;
}
.text {
	right:0;
	width:50%;
	height:100%;
	border-left:1px solid #eee;
	position:absolute;
	overflow:auto;
}
.text nav p,.operation {
	line-height:30px;
}
.text nav p {
	float:left;
	cursor:pointer;
	margin:0 10px;
}
.text nav p.active {
	color:#01c;
}
.text .operation{
	float:right;
}
.text table {
	margin:10px 20px;
	position:absolute;
	left:10px;
	top:40px;
	border-right:1px solid #eee;
	border-bottom:1px solid #eee;
}
.text table td {
	border-left:1px solid #eee;
	border-top:1px solid #eee;
}



.node circle {
	cursor: pointer;
	fill: #fff;
	stroke: steelblue;
	stroke-width: 1.5px;
}
.node text {
	font-size: 11px;
}
path.link {
	fill: none;
	stroke: #ccc;
	stroke-width: 1.5px;
}
</style>
</head><body>


<div class="chart" id="chartDiv">
</div>
<div class="text">
	<nav>
		<p class="active">基本属性</p>
		<p>节点配置</p>
	</nav>
	<div class="operation">
		<input type="button" id="save" value="保存" />
		<input type="button" id="cancel" value="取消" />
	</div>
	<br style="clear:both" />
	<div class="content">
		<table cellpadding="5" cellspacing="0" id="text">
		</table>
		<table cellpadding="5" cellspacing="0" id="text2" style="display:none">
		</table>
	</div>
</div>
<script type="text/javascript">
var html = '{"dyStartUrl": {"params": {"p": {"type": "emun", "value": ["2", "3"]}}, "urlTemplate": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action{p}"}, "requestPageType": {"requestType": "Request", "contentType": "HTML", "method": "get", "renderJs": true}, "schedulerType": "interval", "selectors": [{"currentUrl": "", "multiple": true, "requestPageTypes": {}, "parentSelectors": ["_root", "next_page"], "selector": "table.right_nr_xx tr", "delay": "", "typename": "\u7ec4\u5408\u578b(Element)", "type": "SelectorElement", "id": "items"}, {"regex": "", "currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action", "multiple": false, "requestPageTypes": {}, "parentSelectors": ["items"], "selector": "td:nth-of-type(1) a", "delay": "", "typename": "\u6587\u672c\u578b(Text)", "type": "SelectorText", "id": "number"}, {"currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action", "multiple": false, "requestPageTypes": {}, "parentSelectors": ["items"], "selector": "td:nth-of-type(2) a", "delay": "", "typename": "\u94fe\u63a5\u578b(Link)", "type": "SelectorLink", "id": "title"}, {"regex": "", "currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getTbcxContent.action?mid=21869&amp;TBType=4", "multiple": false, "requestPageTypes": {}, "parentSelectors": ["title"], "selector": "tr:nth-of-type(3) &gt; td:nth-of-type(3)", "delay": "", "typename": "\u6e90\u7801\u578b(Html)", "type": "SelectorHTML", "id": "content"}, {"regex": "", "currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action", "multiple": false, "requestPageTypes": {}, "parentSelectors": ["items"], "selector": "td:nth-of-type(3)", "delay": "", "typename": "\u6587\u672c\u578b(Text)", "type": "SelectorText", "id": "member"}, {"regex": "", "currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action", "multiple": false, "requestPageTypes": {}, "parentSelectors": ["items"], "selector": "td:nth-of-type(4)", "delay": "", "typename": "\u6587\u672c\u578b(Text)", "type": "SelectorText", "id": "department"}, {"regex": "", "currentUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action", "multiple": false, "processors": [{"name": "ProcessorDatetime", "context": ["%Y-%m-%d"]}], "requestPageTypes": {}, "parentSelectors": ["items"], "selector": "td:nth-of-type(5)", "delay": "", "typename": "\u6587\u672c\u578b(Text)", "type": "SelectorText", "id": "pubdate"}, {"currentUrl": "", "multiple": false, "parentSelectors": ["_root", "next_page"], "selector": "li.nextpage a", "delay": "", "typename": "\u94fe\u63a5\u578b(Link)", "requestPageType": {"requestType": "Request", "contentType": "HTML", "method": "get", "renderJs": "true"}, "type": "SelectorClick", "id": "next_page"}], "scheduler": {"every": 1, "period": "hours"}, "_id": "tbt-sps", "startUrl": "http://www.tbt-sps.gov.cn/tbtTbcx/getList.action"}',
	selectors = JSON.parse(html),
	sitemap = new Sitemap(selectors),
	graph = new SelectorGraphv2(sitemap),
	cDiv = document.getElementById("chartDiv"),
	log = function(){for(var arg in arguments) console && console.log(arguments[arg])}, //打印
	json=function(k){return eval('('+k+')')} //字符串转json
	str=function(k){return JSON.stringify(k)} //json转字符串
;
graph.draw(cDiv, cDiv.clientWidth, cDiv.clientHeight*0.9);
var getSvg = (function(){
	var _ddList = {"status":{"id":1,"_list":[{"id":1,"name":"active"},{"id":3,"name":"deleted"},{"id":2,"name":"inactive"}],"name":"active"},"remark":"抽取tbt-sps的通报号、通报标题、通报成员、上报部门、通报时间。","group":{"id":1,"_list":[{"id":1,"name":"疾控"}],"name":"疾控"},"name":"tbt-sps","content":"{\"dyStartUrl\": {\"params\": {\"p\": {\"type\": \"emun\", \"value\": [\"2\", \"3\"]}}, \"urlTemplate\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action{p}\"}, \"requestPageType\": {\"requestType\": \"Request\", \"contentType\": \"HTML\", \"method\": \"get\", \"renderJs\": true}, \"schedulerType\": \"interval\", \"selectors\": [{\"currentUrl\": \"\", \"multiple\": true, \"requestPageTypes\": {}, \"parentSelectors\": [\"_root\", \"next_page\"], \"selector\": \"table.right_nr_xx tr\", \"delay\": \"\", \"typename\": \"\\u7ec4\\u5408\\u578b(Element)\", \"type\": \"SelectorElement\", \"id\": \"items\"}, {\"regex\": \"\", \"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\", \"multiple\": false, \"requestPageTypes\": {}, \"parentSelectors\": [\"items\"], \"selector\": \"td:nth-of-type(1) a\", \"delay\": \"\", \"typename\": \"\\u6587\\u672c\\u578b(Text)\", \"type\": \"SelectorText\", \"id\": \"number\"}, {\"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\", \"multiple\": false, \"requestPageTypes\": {}, \"parentSelectors\": [\"items\"], \"selector\": \"td:nth-of-type(2) a\", \"delay\": \"\", \"typename\": \"\\u94fe\\u63a5\\u578b(Link)\", \"type\": \"SelectorLink\", \"id\": \"title\"}, {\"regex\": \"\", \"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getTbcxContent.action?mid=21869&TBType=4\", \"multiple\": false, \"requestPageTypes\": {}, \"parentSelectors\": [\"title\"], \"selector\": \"tr:nth-of-type(3) > td:nth-of-type(3)\", \"delay\": \"\", \"typename\": \"\\u6e90\\u7801\\u578b(Html)\", \"type\": \"SelectorHTML\", \"id\": \"content\"}, {\"regex\": \"\", \"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\", \"multiple\": false, \"requestPageTypes\": {}, \"parentSelectors\": [\"items\"], \"selector\": \"td:nth-of-type(3)\", \"delay\": \"\", \"typename\": \"\\u6587\\u672c\\u578b(Text)\", \"type\": \"SelectorText\", \"id\": \"member\"}, {\"regex\": \"\", \"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\", \"multiple\": false, \"requestPageTypes\": {}, \"parentSelectors\": [\"items\"], \"selector\": \"td:nth-of-type(4)\", \"delay\": \"\", \"typename\": \"\\u6587\\u672c\\u578b(Text)\", \"type\": \"SelectorText\", \"id\": \"department\"}, {\"regex\": \"\", \"currentUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\", \"multiple\": false, \"processors\": [{\"name\": \"ProcessorDatetime\", \"context\": [\"%Y-%m-%d\"]}], \"requestPageTypes\": {}, \"parentSelectors\": [\"items\"], \"selector\": \"td:nth-of-type(5)\", \"delay\": \"\", \"typename\": \"\\u6587\\u672c\\u578b(Text)\", \"type\": \"SelectorText\", \"id\": \"pubdate\"}, {\"currentUrl\": \"\", \"multiple\": false, \"parentSelectors\": [\"_root\", \"next_page\"], \"selector\": \"li.nextpage a\", \"delay\": \"\", \"typename\": \"\\u94fe\\u63a5\\u578b(Link)\", \"requestPageType\": {\"requestType\": \"Request\", \"contentType\": \"HTML\", \"method\": \"get\", \"renderJs\": \"true\"}, \"type\": \"SelectorClick\", \"id\": \"next_page\"}], \"scheduler\": {\"every\": 1, \"period\": \"hours\"}, \"_id\": \"tbt-sps\", \"startUrl\": \"http://www.tbt-sps.gov.cn/tbtTbcx/getList.action\"}","ower":{"id":3,"_list":[{"id":1,"name":"root"},{"id":2,"name":"wtlu"},{"id":3,"name":"test"},{"id":4,"name":"test2"}],"name":"test"},"id":100}
	var _chartData = json(_ddList.content),
		_chartList = _chartData.selectors;
	log(_chartData);
	var _textDom = $('#text'),
		_textDom2 = $('#text2'),
		_getOpts = function(lsts){
			var htm = '',
				lst = lsts._list;
			for(var s in lst) htm += '<option value="'+lst[s].id+'">'+lst[s].name+'</option>';
			return '<select>'+htm+'</select>';
		},
		_getCnt = function(k,d){
			if(k=='content') d=str(d);
			else if(typeof(d)=='object') d = _getOpts(d);
			else if(typeof(d)=='number') ;
			else{
				d = "<input onkeyup='autoLength(this)' k='"+k+"' onClick='autoLength(this)' type='text' value='"+d+"'/>"
			}
			return d;
		},
		_getCnt2 = function(k,d){
			if(typeof(d)=='object') d = str(d);
			else if(typeof(d)=='number') ;
			else{
				d = "<input onkeyup='autoLength(this)' k='"+k+"' onClick='autoLength(this)' type='text' value='"+d+"'/>"
			}
			return d;
		},
		_getCnt3 = function(k,d){
			if(typeof(d)=='object') d = str(d);
			if(k=='id') {
				_textDom2.attr('d',d);
				return d;
			}
			else return "<input onkeyup='autoLength(this)' k='"+k+"' onClick='autoLength(this)' type='text' value='"+d+"'/>";
		},
		_getText = function(){
			_textDom.html(function(){
				var htm = '';
				for(var dd in _ddList) {
					if(dd!='content') htm += '<tr><td>'+dd+'</td><td>'+_getCnt(dd,_ddList[dd])+'</td></tr>';
				}
				return htm;
			})
		},
		_getText2 = function(data){
			_textDom2.html(function(){
				var htm = '';
				for(var dd in data) htm += '<tr><td>'+dd+'</td><td>'+_getCnt2(dd,data[dd])+'</td></tr>';
				return htm;
			})
		},
		_getText3 = function(data){
			_textDom2.html(function(){
				var htm = '';
				for(var dd in data) htm += '<tr><td>'+dd+'</td><td>'+_getCnt3(dd,data[dd])+'</td></tr>';
				return htm;
			}).find('input').focusout(function(){
				var id = _textDom2.attr('d'),
					k = $(this).attr('k'),
					val = $(this).val()
				;
				if(k=='parentSelectors' || k=='requestPageTypes') val = json(val);
				for(var c in _chartList){
					if(_chartList[c].id==id) _chartList[c][k] = val;
				}
				_chartData.selectors = _chartList;
				_ddList.content = str(_chartData);
			});
		}
	;
	$('.text nav p').click(function(){
		var txt = $(this).text();
		$(this).parent().find('.active').removeClass('active');
		$(this).addClass('active');
		switch(txt){
			case '基本属性':
				_textDom.show();
				_textDom2.hide();
				_getText();
				break;
			case '节点配置':
				_getText2(_chartData);
				_textDom.hide();
				_textDom2.show();
				break;
		}
	});
	$(cDiv).click(function(e){
		var tar = e.target,
			ths = $(tar)
		;
		if(tar.nodeName=='circle'){
			var txt = ths.parent().find('>text').text();
			if(txt=='_root'){
				_getText2(_chartData);
				_textDom.hide();
				_textDom2.show();
			}else {
				for(var cs in _chartList){
					if (_chartList[cs].id==txt){
						_getText3(_chartList[cs]);
						return;
					}
				}
			}
		}
	});
	$('#save').click(function(){
		log(_ddList);
	});
	_getText();
})();
</script><div id="qb-sougou-search" style="display: none; opacity: 0;"><p>搜索</p><p class="last-btn">复制</p><iframe src=""></iframe></div>
</body>
</html>